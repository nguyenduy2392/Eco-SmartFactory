<div class="pmc-container">
  <p-toast></p-toast>
  
  <!-- Header with controls -->
  <div class="pmc-header">
    <h1>{{ title }}</h1>
    
    <div class="pmc-controls" *ngIf="currentWeek">
      <div class="week-info">
        <h2>{{ currentWeek.weekName }}</h2>
        <span class="version-badge">Version {{ currentWeek.version }}</span>
        <span class="status-badge" [class.status-draft]="currentWeek.status === 'DRAFT'"
                                    [class.status-approved]="currentWeek.status === 'APPROVED'">
          {{ currentWeek.status }}
        </span>
      </div>
      
      <div class="action-buttons">
        <!-- Week navigation -->
        <button pButton type="button" icon="pi pi-chevron-left" 
                class="p-button-outlined p-button-sm"
                (click)="loadPreviousWeek()"
                [disabled]="loading"
                pTooltip="Tuần trước"></button>
        
        <button pButton type="button" icon="pi pi-chevron-right" 
                class="p-button-outlined p-button-sm"
                (click)="loadNextWeek()"
                [disabled]="loading"
                pTooltip="Tuần sau"></button>
        
        <!-- Version selector -->
        <p-dropdown [options]="weekVersions" 
                    [(ngModel)]="selectedVersion"
                    (onChange)="onVersionChange()"
                    optionLabel="version"
                    [style]="{'width':'150px'}"
                    placeholder="Chọn version"
                    [disabled]="loading">
          <ng-template let-item pTemplate="selectedItem">
            <span>v{{ item.version }} - {{ item.createdByName }}</span>
          </ng-template>
          <ng-template let-item pTemplate="item">
            <div class="version-item">
              <span class="version-number">v{{ item.version }}</span>
              <span class="version-info">{{ item.createdByName }} - {{ item.createdAt | date:'short' }}</span>
            </div>
          </ng-template>
        </p-dropdown>
        
        <!-- Action buttons -->
        <button pButton type="button" label="Lưu" icon="pi pi-save" 
                class="p-button-success"
                (click)="saveCurrentWeek()"
                [disabled]="loading || !hasChanges"
                [loading]="loading"></button>
        
        <button pButton type="button" label="Tạo PMC Tuần Mới" icon="pi pi-plus" 
                class="p-button-primary"
                (click)="createNewWeek(false)"
                [disabled]="loading"
                [loading]="loading"></button>
      </div>
    </div>
    
    <!-- No data state -->
    <div class="no-data" *ngIf="!currentWeek && !loading">
      <i class="pi pi-calendar" style="font-size: 3rem; color: #ccc;"></i>
      <p>Chưa có PMC cho tuần này</p>
      <button pButton type="button" label="Tạo PMC Tuần Mới" icon="pi pi-plus" 
              class="p-button-lg p-button-primary"
              (click)="createNewWeek(false)"></button>
      <button pButton type="button" label="Tạo từ Tuần Trước" icon="pi pi-copy" 
              class="p-button-lg p-button-outlined"
              (click)="createNewWeek(true)"></button>
      <button pButton type="button" label="Debug: Kiểm tra PO" icon="pi pi-search" 
              class="p-button-lg p-button-outlined p-button-secondary"
              (click)="debugAvailablePOs()"></button>
    </div>
  </div>
  
  <!-- Grid -->
  <div class="grid-wrapper" *ngIf="currentWeek">
    <div *ngIf="hotData.length === 0" class="no-grid-data">
      <i class="pi pi-table" style="font-size: 3rem; color: #ccc;"></i>
      <p>Chưa có dữ liệu PMC. Vui lòng tạo dữ liệu từ "Tạo PMC Tuần Mới".</p>
      <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
        <button pButton type="button" label="Debug: Kiểm tra PO có sẵn" icon="pi pi-search" 
                class="p-button-outlined p-button-secondary"
                (click)="debugAvailablePOs()"></button>
        <button pButton type="button" label="Tạo lại PMC" icon="pi pi-refresh" 
                class="p-button-outlined p-button-primary"
                (click)="createNewWeek(false)"></button>
      </div>
    </div>
    
    <div #hotContainer class="pmc-hot-table" [style.display]="hotData.length > 0 ? 'block' : 'none'"></div>
  </div>
  
  <!-- Loading overlay -->
  <div class="loading-overlay" *ngIf="loading">
    <i class="pi pi-spin pi-spinner" style="font-size: 3rem;"></i>
    <p>Đang tải...</p>
  </div>
  
  <!-- Info footer -->
  <div class="pmc-footer" *ngIf="currentWeek">
    <div class="legend">
      <span class="legend-item">
        <span class="legend-color cell-requirement"></span>
        <span>Yêu cầu KH</span>
      </span>
      <span class="legend-item">
        <span class="legend-color cell-production"></span>
        <span>Kế hoạch SX</span>
      </span>
      <span class="legend-item">
        <span class="legend-color cell-clamp"></span>
        <span>Kẹp</span>
      </span>
    </div>
    
    <div class="info-text">
      <i class="pi pi-info-circle"></i>
      <span>Click vào ô để chỉnh sửa. Chỉ có thể sửa ô "Kế hoạch SX" và "Kẹp".</span>
    </div>
  </div>
</div>
